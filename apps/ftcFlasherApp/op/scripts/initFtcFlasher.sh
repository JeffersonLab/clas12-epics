#!/bin/sh
#These commands need to be run when the IOC is started. Add as required.

#look at the Manual, and $EPICS/apps/iocBoot/iocFlasher/flasher.db to see channels.

scriptdir="${EPICS_SCRIPTS}"
Prefix="B_DET_FTC_FLASHER"

##This lot for the TOP module
##Set the default init files (in user space)
caput -S ${Prefix}:SEQ_FILE ${scriptdir}/ftcFlasherDefaultSeq.sh
caput -S ${Prefix}:DATA_FILE_LOAD ${scriptdir}/ftcFlasherData/ftcFlasherDefaultChannels.dat
caput -S ${Prefix}:DATA_FILE_SAVE ${scriptdir}/ftcFlasherData/ftcFlasherDefaultChannels.dat


caput -a ${Prefix}:X_TABLE 336 -6 999 -5 -7 -7 -6 -5 -8 -7 -6 -9 -8 -5 -4 -7 -6 -9 -8 -4 -10 -6 -5 -8 -7 -10 -9 -4 -3 -6 -5 -8 -7 -10 -9 -5 -4 -7 -6 -9 -8 -5 -10 -7 -6 -9 -8 -5 -10 -7 -6 -9 -8 -11 -10 -11 -11 -5 999 -7 -6 -9 -8 -11 -10 -6 -5 -8 -7 -10 -9 -4 -11 -6 -5 -8 -7 -10 -9 -3 -11 -5 -4 -7 -6 -9 -8 -4 -10 -6 -5 -8 -7 -10 -9 -5 -4 -7 -6 -9 -8 -5 -10 -7 -6 -9 -8 -6 -5 -8 -7 -7 -6 -6 -5 -5 -4 -4 -4 -4 -3 -3 -3 -3 -3 -3 -3 -2 -2 -2 -2 -2 -2 -2 -1 -1 -1 -1 -1 -1 -1 1 1 1 1 1 1 1 2 2 2 2 2 2 2 3 3 3 3 3 3 3 4 4 4 4 5 5 6 7 999 8 6 6 7 9 5 7 8 5 6 9 10 7 8 5 6 10 4 8 9 6 7 4 5 9 10 7 8 5 6 3 4 9 10 7 8 5 6 10 4 8 9 6 7 10 5 8 9 6 7 11 5 11 11 11 999 11 11 9 10 7 8 5 6 9 10 7 8 5 6 9 10 7 8 5 6 10 4 8 9 6 7 4 5 10 3 8 9 6 7 4 5 9 10 7 8 5 6 9 4 7 8 5 6 7 8 5 6 6 7 5 6 4 5 4 4 3 4 3 3 3 3 3 3 2 2 2 2 2 2 1 2 1 1 1 1 1 1 -1 -1 -1 -1 -1 -1 -2 -1 -2 -2 -2 -2 -2 -2 -3 -3 -3 -3 -3 -3 -4 -3 -4 -4 -5 -4 -6 -5
caput -a ${Prefix}:Y_TABLE 336 9 999 8 9 8 8 7 8 7 7 7 7 6 6 6 6 6 6 5 6 5 5 5 5 5 5 4 4 4 4 4 4 4 4 3 3 3 3 3 3 2 3 2 2 2 2 1 2 1 1 1 1 1 1 3 2 -1 999 -1 -1 -1 -1 -1 -1 -2 -2 -2 -2 -2 -2 -3 -2 -3 -3 -3 -3 -3 -3 -4 -3 -4 -4 -4 -4 -4 -4 -5 -4 -5 -5 -5 -5 -5 -5 -6 -6 -6 -6 -6 -6 -7 -6 -7 -7 -7 -7 -8 -8 -8 -8 -9 -9 -10 -9 -10 -7 -8 -9 -10 -5 -6 -7 -8 -9 -10 -11 -5 -6 -7 -8 -9 -10 -11 -5 -6 -7 -8 -9 -10 -11 -5 -6 -7 -8 -9 -10 -11 -5 -6 -7 -8 -9 -10 -11 -5 -6 -7 -8 -9 -10 -11 -7 -8 -9 -10 -9 -10 -10 -9 999 -8 -9 -8 -8 -7 -8 -7 -7 -7 -7 -6 -6 -6 -6 -6 -6 -5 -6 -5 -5 -5 -5 -5 -5 -4 -4 -4 -4 -4 -4 -4 -4 -3 -3 -3 -3 -3 -3 -2 -3 -2 -2 -2 -2 -1 -2 -1 -1 -1 -1 -3 -1 -1 -2 3 999 1 2 1 1 1 1 1 1 2 2 2 2 2 2 3 3 3 3 3 3 4 3 4 4 4 4 4 4 5 4 5 5 5 5 5 5 6 6 6 6 6 6 7 6 7 7 7 7 8 8 8 8 9 9 10 10 10 9 8 9 11 7 9 10 7 8 5 6 10 11 8 9 6 7 11 5 9 10 7 8 5 6 10 11 8 9 6 7 11 5 9 10 7 8 5 6 10 11 8 9 6 7 10 5 8 9 10 7 10 9
caput -a ${Prefix}:ID_TABLE 336 423 999 402 422 400 401 380 399 378 379 376 377 358 359 356 357 354 355 337 353 335 336 333 334 331 332 315 316 313 314 311 312 309 310 292 293 290 291 288 289 270 287 268 269 266 267 248 265 246 247 244 245 242 243 286 264 226 999 224 225 222 223 220 221 203 204 201 202 199 200 183 198 181 182 179 180 177 178 162 176 160 161 158 159 156 157 139 155 137 138 135 136 133 134 116 117 114 115 112 113 94 111 92 93 90 91 71 72 69 70 48 49 27 50 28 95 73 51 29 140 118 96 74 52 30 8 141 119 97 75 53 31 9 142 120 98 76 54 32 10 143 121 99 77 55 33 11 144 122 100 78 56 34 12 145 123 101 79 57 35 13 102 80 58 36 59 37 38 61 999 84 60 82 83 107 81 105 106 103 104 129 130 127 128 125 126 152 124 150 151 148 149 146 147 173 174 171 172 169 170 167 168 195 196 193 194 191 192 218 190 216 217 214 215 240 213 238 239 236 237 197 235 241 219 307 999 263 285 261 262 259 260 257 258 283 284 281 282 279 280 305 306 303 304 301 302 328 300 326 327 324 325 322 323 350 321 348 349 346 347 344 345 371 372 369 370 367 368 393 366 391 392 389 390 413 414 411 412 434 435 455 456 454 433 410 432 475 388 431 453 387 409 343 365 452 474 408 430 364 386 473 342 429 451 385 407 341 363 450 472 406 428 362 384 471 340 427 449 383 405 339 361 448 470 404 426 360 382 447 338 403 425 446 381 445 424

caput -a ${Prefix}:NEXT_TABLE 336 335 330 330 0 5 2 333 4 9 6 11 8 13 326 15 12 17 14 329 16 21 18 23 20 25 22 27 255 29 26 31 28 33 30 35 247 37 34 39 36 238 38 43 40 45 42 232 44 49 46 51 48 53 50 41 47 221 59 59 56 61 58 63 60 65 215 67 64 69 66 209 68 73 70 75 72 77 74 200 76 81 78 83 80 85 82 119 84 89 86 91 88 93 90 95 120 97 94 99 96 115 98 103 100 105 102 107 116 109 106 111 113 114 117 118 121 122 123 124 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 192 187 161 162 163 164 112 178 175 165 166 171 167 110 108 104 104 168 173 170 101 172 177 174 179 176 181 92 183 180 185 182 87 184 189 186 191 188 193 190 195 79 197 194 199 196 201 198 203 220 205 202 207 204 223 206 211 208 213 210 222 212 217 214 219 216 71 218 52 62 32 55 55 54 229 226 231 228 233 230 235 227 237 234 239 236 241 224 243 240 245 242 24 244 249 246 251 248 253 250 19 252 257 254 259 256 261 258 263 10 265 262 267 264 7 266 271 268 273 270 275 3 277 274 279 334 281 323 280 278 276 283 125 272 285 282 287 284 260 269 289 286 291 288 293 290 295 292 297 294 299 296 301 298 303 300 305 302 307 304 309 306 311 308 313 310 315 312 317 314 319 316 321 318 322 320 324 325 328 327 332 331
caput -a ${Prefix}:PREV_TABLE 336 3 3 3 275 7 4 9 268 11 8 263 10 15 12 17 14 19 16 21 254 23 20 25 22 246 24 29 26 31 28 33 30 224 32 37 34 39 36 41 38 43 54 45 42 47 44 49 55 51 48 53 50 222 52 227 226 59 59 61 58 63 60 223 62 67 64 69 66 71 68 73 220 75 72 77 74 79 76 81 195 83 80 85 82 87 84 89 186 91 88 93 90 181 92 97 94 99 96 101 98 103 174 105 102 170 104 109 106 168 108 167 110 160 111 112 100 107 113 114 86 95 115 116 117 118 286 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 156 157 158 159 163 164 166 171 171 173 165 175 172 177 162 179 176 161 178 183 180 185 182 187 184 189 155 191 188 193 190 154 192 197 194 199 196 201 198 78 200 205 202 207 204 209 206 211 70 213 210 215 212 217 65 219 216 221 218 203 56 214 208 241 241 229 235 231 228 233 230 46 232 237 234 239 236 40 238 243 240 245 242 247 244 249 35 251 248 253 250 255 252 257 27 259 256 261 258 292 260 265 262 267 264 269 266 271 293 273 270 287 272 277 274 284 276 283 278 282 280 289 285 291 288 295 290 297 294 299 296 301 298 303 300 305 302 307 304 309 306 311 308 313 310 315 312 317 314 319 316 321 318 323 320 325 322 327 324 329 326 328 281 330 331 13 333 332 18 2 335 334 6 279 0


##Set to overwrite mode
caput ${Prefix}:SET_OWR 1

##Set trigger to internal
caput ${Prefix}:SET_CLOCK INT

##Load the channels widths and amplitudes from the default file
${scriptdir}/loadFlasherChannelsFromFile.sh ${Prefix}

##Load the default sequence
${scriptdir}/ftcFlasherDefaultSeq.sh ${Prefix}

##Set the initial selected channel
caput ${Prefix}:SELECTED_CHANNEL 0

##Flag that INIT has taken place
caput ${Prefix}:IOC_INIT 1


