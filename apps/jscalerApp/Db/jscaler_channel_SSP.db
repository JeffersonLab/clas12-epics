
########################################################################
# all scalers from one fiber:
record(waveform, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch):scalers") {
    field(DTYP,"JLAB_SCALERS")
    field(DESC,"SSP scaler waveform")
    field(INP,"#C$(CScode) S$(Counts)")
    field(NELM,"192")
    field(FTVL,"DOUBLE")
    field(SCAN,"2 second")
    field(FLNK,"B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT0:scalers")
    info(autosaveFields_pass0,"DESC")
}
## all data from one fiber (we're deprecating this):
#record(waveform, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch):data") {
#    field(DTYP,"JLAB_SCALERS")
#    field(DESC,"SSP data waveform")
#    field(INP,"#C$(CScode) S$(Data)")
#    field(NELM,"9")
#    field(FTVL,"DOUBLE")
#    field(SCAN,"2 second")
#}

# individual temperatures and voltages (todo: replace temp#/volt# suffix with proper name):
record(ai, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch):temp:fpga") {
    field(DTYP,"JLAB_SCALERS")
    field(INP,"#C$(CScode) S$(Temp1)")
    field(SCAN,"2 second")
    field(EGU,"C")
    field(EGUL,0)
    field(ESLO,0.001)
    field(PREC,2)
    field(LINR,"LINEAR")
    field(HHSV,"MAJOR")
    field(HSV,"MINOR")
    field(LSV,"MINOR")
    field(LLSV,"MAJOR")
    field(HIHI,85)
    field(HIGH,75)
    field(LOW,40)
    field(LOLO,10)
    info(autosaveFields_pass0,"HHSV HSV LSV LLSV HIHI HIGH LOW LOLO DESC")
}
record(ai, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch):temp:reg0") {
    field(DTYP,"JLAB_SCALERS")
    field(INP,"#C$(CScode) S$(Temp2)")
    field(SCAN,"2 second")
    field(EGU,"C")
    field(EGUL,0)
    field(ESLO,0.001)
    field(PREC,2)
    field(LINR,"LINEAR")
    field(HHSV,"MAJOR")
    field(HSV,"MINOR")
    field(LSV,"MINOR")
    field(LLSV,"MAJOR")
    field(HIHI,85)
    field(HIGH,75)
    field(LOW,40)
    field(LOLO,10)
    info(autosaveFields_pass0,"HHSV HSV LSV LLSV HIHI HIGH LOW LOLO DESC")
}
record(ai, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch):temp:reg1") {
    field(DTYP,"JLAB_SCALERS")
    field(INP,"#C$(CScode) S$(Temp3)")
    field(SCAN,"2 second")
    field(EGU,"C")
    field(EGUL,0)
    field(ESLO,0.001)
    field(PREC,2)
    field(LINR,"LINEAR")
    field(HHSV,"MAJOR")
    field(HSV,"MINOR")
    field(LSV,"MINOR")
    field(LLSV,"MAJOR")
    field(HIHI,85)
    field(HIGH,75)
    field(LOW,40)
    field(LOLO,10)
    info(autosaveFields_pass0,"HHSV HSV LSV LLSV HIHI HIGH LOW LOLO DESC")
}
record(ai, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch):volt:pcb5") {
    field(DTYP,"JLAB_SCALERS")
    field(INP,"#C$(CScode) S$(Volt1)")
    field(SCAN,"2 second")
    field(EGU,"V")
    field(EGUL,0)
    field(ESLO,0.001)
    field(PREC,3)
    field(LOLO,4.5)
    field(LOW,4.75)
    field(HIGH,5.25)
    field(HIHI,5.50)
    field(LINR,"LINEAR")
    field(HHSV,"MAJOR")
    field(HSV,"MINOR")
    field(LSV,"MINOR")
    field(LLSV,"MAJOR")
    info(autosaveFields_pass0,"HHSV HSV LSV LLSV HIHI HIGH LOW LOLO DESC")
}
record(ai, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch):volt:pcb3_3") {
    field(DTYP,"JLAB_SCALERS")
    field(INP,"#C$(CScode) S$(Volt2)")
    field(SCAN,"2 second")
    field(EGU,"V")
    field(EGUL,0)
    field(ESLO,0.001)
    field(PREC,3)
    field(LOLO,2.97)
    field(LOW,3.14)
    field(HIGH,3.47)
    field(HIHI,3.63)
    field(LINR,"LINEAR")
    field(HHSV,"MAJOR")
    field(HSV,"MINOR")
    field(LSV,"MINOR")
    field(LLSV,"MAJOR")
    info(autosaveFields_pass0,"HHSV HSV LSV LLSV HIHI HIGH LOW LOLO DESC")
}
record(ai, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch):volt:int1") {
    field(DTYP,"JLAB_SCALERS")
    field(INP,"#C$(CScode) S$(Volt3)")
    field(SCAN,"2 second")
    field(EGU,"V")
    field(EGUL,0)
    field(ESLO,0.001)
    field(PREC,3)
    field(LOLO,0.90)
    field(LOW,0.95)
    field(HIGH,1.05)
    field(HIHI,1.10)
    field(LINR,"LINEAR")
    field(HHSV,"MAJOR")
    field(HSV,"MINOR")
    field(LSV,"MINOR")
    field(LLSV,"MAJOR")
    info(autosaveFields_pass0,"HHSV HSV LSV LLSV HIHI HIGH LOW LOLO DESC")
}
record(ai, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch):volt:aux1_8") {
    field(DTYP,"JLAB_SCALERS")
    field(INP,"#C$(CScode) S$(Volt4)")
    field(SCAN,"2 second")
    field(EGU,"V")
    field(EGUL,0)
    field(ESLO,0.001)
    field(PREC,3)
    field(LOLO,1.62)
    field(LOW,1.71)
    field(HIGH,1.89)
    field(HIHI,1.98)
    field(LINR,"LINEAR")
    field(HHSV,"MAJOR")
    field(HSV,"MINOR")
    field(LSV,"MINOR")
    field(LLSV,"MAJOR")
    info(autosaveFields_pass0,"HHSV HSV LSV LLSV HIHI HIGH LOW LOLO DESC")
}
record(ai, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch):volt:mgt1") {
    field(DTYP,"JLAB_SCALERS")
    field(INP,"#C$(CScode) S$(Volt5)")
    field(SCAN,"2 second")
    field(EGU,"V")
    field(EGUL,0)
    field(ESLO,0.001)
    field(PREC,3)
    field(LOLO,0.90)
    field(LOW,0.95)
    field(HIGH,1.05)
    field(HIHI,1.10)
    field(LINR,"LINEAR")
    field(HHSV,"MAJOR")
    field(HSV,"MINOR")
    field(LSV,"MINOR")
    field(LLSV,"MAJOR")
    info(autosaveFields_pass0,"HHSV HSV LSV LLSV HIHI HIGH LOW LOLO DESC")
}
record(ai, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch):volt:mgt1_2") {
    field(DTYP,"JLAB_SCALERS")
    field(INP,"#C$(CScode) S$(Volt6)")
    field(SCAN,"2 second")
    field(EGU,"V")
    field(EGUL,0)
    field(ESLO,0.001)
    field(PREC,3)
    field(LOLO,1.08)
    field(LOW,1.14)
    field(HIGH,1.25)
    field(HIHI,1.32)
    field(LINR,"LINEAR")
    field(HHSV,"MAJOR")
    field(HSV,"MINOR")
    field(LSV,"MINOR")
    field(LLSV,"MAJOR")
    info(autosaveFields_pass0,"HHSV HSV LSV LLSV HIHI HIGH LOW LOLO DESC")
}

########################################################################
# single-PMT scalers:
record(subArray, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT0:scalers") {
    field(INP,"B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch):scalers")
    field(NELM,64)
    field(MALM,64)
    field(INDX,0)
    field(FTVL,"DOUBLE")
    field(FLNK,"B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT1:scalers")
    info(autosaveFields_pass0,"DESC")
}
record(subArray, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT1:scalers") {
    field(INP,"B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch):scalers")
    field(NELM,64)
    field(MALM,128)
    field(INDX,64)
    field(FTVL,"DOUBLE")
    field(FLNK,"B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT2:scalers")
    info(autosaveFields_pass0,"DESC")
}
record(subArray, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT2:scalers") {
    field(INP,"B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch):scalers")
    field(NELM,64)
    field(MALM,192)
    field(INDX,128)
    field(FTVL,"DOUBLE")
    field(FLNK,"B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT0:scalersAvgC")
    info(autosaveFields_pass0,"DESC")
}

########################################################################
# single-PMT scaler averages:
record(compress, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT0:scalersAvgC") {
    field(INP,"B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT0:scalers")
    field(ALG,"N to 1 Average")
    field(NSAM,1)
    field(N,64)
    field(PREC,1)
    field(FLNK,"B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT1:scalersAvgC")
    info(autosaveFields_pass0,"DESC")
}
record(compress, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT1:scalersAvgC") {
    field(INP,"B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT1:scalers")
    field(ALG,"N to 1 Average")
    field(NSAM,1)
    field(N,64)
    field(PREC,1)
    field(FLNK,"B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT2:scalersAvgC")
    info(autosaveFields_pass0,"DESC")
}
record(compress, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT2:scalersAvgC") {
    field(INP,"B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT2:scalers")
    field(ALG,"N to 1 Average")
    field(NSAM,1)
    field(N,64)
    field(PREC,1)
    info(autosaveFields_pass0,"DESC")
}

# ao records for scaler averages, just to be able to set alarm limits:
record(ao, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT0:scalersAvg") {
    field(OMSL,"closed_loop")
    field(DOL,"B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT0:scalersAvgC CPP NMS")
    field(HHSV,"MAJOR")
    field(HSV,"MINOR")
    field(LSV,"NO_ALARM")
    field(LLSV,"INVALID")
    field(HIHI,"1e7")
    field(HIGH,"1e6")
    field(LOW,"0")
    field(LOLO,"-1")
    field(EGU,"Hz")
    info(autosaveFields_pass0,"HHSV HSV LSV LLSV HIHI HIGH LOW LOLO DESC")
}
record(ao, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT1:scalersAvg") {
    field(OMSL,"closed_loop")
    field(DOL,"B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT1:scalersAvgC CPP NMS")
    field(HHSV,"MAJOR")
    field(HSV,"MINOR")
    field(LSV,"NO_ALARM")
    field(LLSV,"INVALID")
    field(HIHI,"1e7")
    field(HIGH,"1e6")
    field(LOW,"0")
    field(LOLO,"-1")
    field(EGU,"Hz")
    info(autosaveFields_pass0,"HHSV HSV LSV LLSV HIHI HIGH LOW LOLO DESC")
}
record(ao, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT2:scalersAvg") {
    field(OMSL,"closed_loop")
    field(DOL,"B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT2:scalersAvgC CPP NMS")
    field(HHSV,"MAJOR")
    field(HSV,"MINOR")
    field(LSV,"NO_ALARM")
    field(LLSV,"INVALID")
    field(HIHI,"1e7")
    field(HIGH,"1e6")
    field(LOW,"0")
    field(LOLO,"-1")
    field(EGU,"Hz")
    info(autosaveFields_pass0,"HHSV HSV LSV LLSV HIHI HIGH LOW LOLO DESC")
}

# convert to kHz:
record(ai, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT0:scalersAvgK") {
    field(DTYP,"Raw Soft Channel")
    field(INP,"B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT0:scalersAvgC CPP NMS")
    field(EGUL,0)
    field(ESLO,0.001)
    field(PREC,2)
    field(LINR,"LINEAR")
    field(EGU,"kHz")
    field(HHSV,"MAJOR")
    field(HSV,"MINOR")
    field(LLSV,"INVALID")
    field(LOLO,"-1e-3")
    field(HIHI,"1e4")
    field(HIGH,"1e3")
    info(autosaveFields_pass0,"HHSV HSV LLSV HIHI HIGH LOLO DESC")
}
record(ai, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT1:scalersAvgK") {
    field(DTYP,"Raw Soft Channel")
    field(INP,"B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT1:scalersAvgC CPP NMS")
    field(EGUL,0)
    field(ESLO,0.001)
    field(PREC,2)
    field(LINR,"LINEAR")
    field(EGU,"kHz")
    field(HHSV,"MAJOR")
    field(HSV,"MINOR")
    field(LLSV,"INVALID")
    field(LOLO,"-1e-3")
    field(HIHI,"1e4")
    field(HIGH,"1e3")
    info(autosaveFields_pass0,"HHSV HSV LLSV HIHI HIGH LOLO DESC")
}
record(ai, "B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT2:scalersAvgK") {
    field(DTYP,"Raw Soft Channel")
    field(INP,"B_HW_$(CrName)_Sl$(Sl)_Fi$(Ch)_PMT2:scalersAvgC CPP NMS")
    field(EGUL,0)
    field(ESLO,0.001)
    field(PREC,2)
    field(LINR,"LINEAR")
    field(EGU,"kHz")
    field(HHSV,"MAJOR")
    field(HSV,"MINOR")
    field(LLSV,"INVALID")
    field(LOLO,"-1e-3")
    field(HIHI,"1e4")
    field(HIGH,"1e3")
    info(autosaveFields_pass0,"HHSV HSV LLSV HIHI HIGH LOLO DESC")
}


