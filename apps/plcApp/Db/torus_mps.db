#
# torus_mps.db - Torus Magnet Power Supply
#
# Author: Wesley Moore (wmoore@jlab.org)
# Date:   Feb 2015
#

record(stringout, "$(P)$(R)man_cmd") {
    field(DESC, "Manual Command")
    field(DTYP, "EtherIP")
    field(SCAN, "1 second")
    field(INP,  "@$(PLCID) Torus_MPS.Man_Cmd")
    field(FLNK, "$(P)$(R)man_cmd_resp")
}
record(stringin, "$(P)$(R)man_cmd") {
    field(DESC, "Manual Command")
    field(DTYP, "EtherIP")
    field(SCAN, "1 second")
    field(INP,  "@$(PLCID) Torus_MPS.Man_Cmd")
    field(FLNK, "$(P)$(R)man_cmd_resp")
}

#record(waveform, "$(P)$(R)adc_vals") {
#    field(DESC, "ADC array")
#    field(DTYP, "EtherIP")
#    field(NELM, "32")
#    field(FTVL, "DOUBLE")
#    field(SCAN, "1 second")
#    field(INP,  "@$(PLCID) Torus_MPS.ADC_Values")
#}

record(waveform, "$(P)$(R)adc_scales") {
    field(DESC, "ADC scale factor array")
    field(DTYP, "EtherIP")
    field(NELM, "32")
    field(FTVL, "LONG")
    field(SCAN, "1 second")
    field(INP,  "@$(PLCID) Torus_MPS.ADC_Values")
}

record(ao, "$(P)$(R)slew") {
    field(DTYP, "EtherIP")
    field(SCAN, "1 second")
    field(INP,  "@$(PLCID) Torus_MPS.Slew_fromHMI")
    field(EGU,  "mA/s")
    field(PREC, "0")
}

record(ao, "$(P)$(R)Iset") {
    field(DTYP, "EtherIP")
    field(SCAN, "1 second")
    field(INP,  "@$(PLCID) Torus_MPS.I_fromHMI")
    field(EGU,  "A")
    field(PREC, "2")
}

record(ai, "$(P)$(R)I") {
    field(DTYP, "EtherIP")
    field(SCAN, "1 second")
    field(INP,  "@$(PLCID) Torus_MPS.I_fromMPS")
    field(EGU,  "A")
    field(PREC, "2")
}

record(ai, "$(P)$(R)I_ZFCT") {
    field(DTYP, "EtherIP")
    field(SCAN, "1 second")
    field(INP,  "@$(PLCID) Torus_MPS.I_fromZFCT")
    field(EGU,  "A")
    field(PREC, "2")
}

record(ai, "$(P)$(R)Iset_rdbk") {
    field(DTYP, "EtherIP")
    field(SCAN, "1 second")
    field(INP,  "@$(PLCID) Torus_MPS.I_setting")
    field(EGU,  "A")
    field(PREC, "2")
}

record(ai, "$(P)$(R)Imax") {
    field(DTYP, "EtherIP")
    field(SCAN, "1 second")
    field(INP,  "@$(PLCID) Torus_MPS.I_Capacity")
    field(EGU,  "A")
    field(PREC, "2")
}

record(ai, "$(P)$(R)slew_rdbk") {
    field(DTYP, "EtherIP")
    field(SCAN, "1 second")
    field(INP,  "@$(PLCID) Torus_MPS.SlewRate")
    field(EGU,  "A")
    field(PREC, "2")
}

record(ai, "$(P)$(R)Imax_sftlmt") {
    field(DESC, "User current limit")
    field(DTYP, "EtherIP")
    field(SCAN, "1 second")
    field(INP,  "@$(PLCID) Torus_MPS.Max_Current_Soft")
    field(EGU,  "A")
    field(PREC, "2")
}

record(waveform, "$(P)$(R)status") {
    field(DESC, "Status array")
    field(DTYP, "EtherIP")
    field(NELM, "32")
    field(FTVL, "LONG")
    field(SCAN, "1 second")
    field(INP,  "@$(PLCID) Torus_MPS.Status1_BOOLS")
}

record(waveform, "$(P)$(R)status_trips") {
    field(DESC, "Status array, 1st trip")
    field(DTYP, "EtherIP")
    field(NELM, "32")
    field(FTVL, "LONG")
    field(SCAN, "1 second")
    field(INP,  "@$(PLCID) Torus_MPS.Status1_1st_BOOLS")
}

record(waveform, "$(P)$(R)active_flags") {
    field(DESC, "Flags array")
    field(DTYP, "EtherIP")
    field(NELM, "64")
    field(FTVL, "LONG")
    field(SCAN, "1 second")
    field(INP,  "@$(PLCID) Torus_MPS.Active_Flags")
}

record(bi, "$(P)$(R)comm_error") {
    field(DTYP, "EtherIP")
    field(SCAN, "1 second")
    field(INP,  "@$(PLCID) Torus_MPS.CommError")
    field(ZSV,  "NO_ALARM")
    field(OSV, "MAJOR")
}

record(bo, "$(P)$(R)comm_reset") {
    field(DTYP, "EtherIP")
    field(INP,  "@$(PLCID) Torus_MPS.Reset_sw")
}

record(bi, "$(P)$(R)mode") {
    field(DTYP, "EtherIP")
    field(SCAN, "1 second")
    field(INP,  "@$(PLCID) Torus_MPS.LocalFlag")
    field(ZNAM, "REMOTE")
    field(ONAM, "LOCAL")
}

record(bo, "$(P)$(R)mode_set") {
    field(DTYP, "EtherIP")
    field(OUT,  "@$(PLCID) Torus_MPS.LocalFlag")
    field(ZNAM, "REMOTE")
    field(ONAM, "LOCAL")
}

record(bi, "$(P)$(R)polarity") {
    field(DTYP, "EtherIP")
    field(SCAN, "1 second")
    field(INP,  "@$(PLCID) Torus_MPS.Polarity")
    field(ZNAM, "NEGATIVE")
    field(ONAM, "POSITIVE")
}

record(bo, "$(P)$(R)contactor_set") {
    field(DTYP, "EtherIP")
    field(OUT,  "@$(PLCID) Torus.MPS.Contactor_SW")
    field(ZNAM, "")
    field(ONAM, "")
}

record(bo, "$(P)$(R)intlock_reset") {
    field(DTYP, "EtherIP")
    field(OUT,  "@$(PLCID) Torus.MPS.interlockReset_SW")
}
